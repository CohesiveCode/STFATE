      SUBROUTINE ESTGEO(DEPTH,ICODE,NMAX,MMAX)
C
C     ROUTINE TO DEFINE ESTUARY GEOMETRY AND CODED ARRAY
C
         DIMENSION DEPTH(NMAX,1),ICODE(NMAX,1)
         COMMON/BAY/ DX,DTL,XBARGE,ZBARGE,DXH,DXR,AREA
         COMMON/GUIDE2/ NIND,NLINE(150),MF(150),ML(150)
C
C     READ GRID SPACE STEP
         READ(5,45) DX
   45    FORMAT(8E10.0)
         WRITE(6,65) NMAX,MMAX,DX
   65    FORMAT(10X,56HNUMBER OF LONG TERM GRID POINTS IN Z-DIRECTION
     1   (NMAX) =,I3//10X,
     2    56HNUMBER OF LONG TERM GRID POINTS IN X-DIRECTION (MMAX) =,
     3    I3//10X,20HGRID SPACING (DX) =,F12.5)
C
C     SET CONSTANTS
         DXH=DX*0.5
         DXR=1./DX
         AREA=DX**2
C
C     READ DEPTHS
         DO 10 M=1,MMAX
C
C
   10    READ(5,15) (DEPTH(N,M),N=1,NMAX)
   15    FORMAT(16F5.0)
C
C     GENERATE CODED ARRAY
         IWPT=0
         DO 20 M=1,MMAX
            DO 20 N=1,NMAX
               ICODE(N,M)=1
               IF(DEPTH(N,M).LE.0.) ICODE(N,M)=2
               IF(ICODE(N,M).EQ.2) GOTO 19
               IF(N.EQ.1.OR.N.EQ.NMAX.OR.M.EQ.1.OR.M.EQ.MMAX) ICODE(N,M)=3
   19          IF(ICODE(N,M).EQ.1) IWPT=IWPT+1
   20    CONTINUE
C     GENERATE ARRAYS GOVERNING CALCULATIONS
         NIND=0
         DO 100 N=1,NMAX
            DO 100 M=1,MMAX
               IF(ICODE(N,M).NE.1) GOTO 100
               IF(ICODE(N,M-1).EQ.1) GOTO 50
C
C
C     HERE TO START A LINE OF COMPUTATION
               NIND = NIND+1
               IF(NIND.LT.151) GOTO 40
               WRITE(6,28)
   28          FORMAT(//2X,111HARRAYS IN COMMON BLOCK/GUIDE2/ FILLED...
     1          CALL EXIT...USER SHOULD INCREASE DIMENSIONS AND CHANGE
     2          CHECK STATEMENT)
               CALL EXIT
   40          CONTINUE
               NLINE(NIND)=N
               MF(NIND)=M
               GOTO 100
   50          IF(ICODE(N,M+1).EQ.1) GOTO 100
C     HERE TO END A LINE OF COMPUTATION
               ML(NIND)=M
  100    CONTINUE
C     PRINT ARRAYS
         WRITE(6,115)
  115    FORMAT(1H1,10X,21HDEPTH GRID FOLLOWS.../)
         NCP = NMAX/24+1
         IF(((NCP-1)*24).EQ.NMAX) NCP=NCP-1
         IN2=0
         DO 130 IP=1,NCP
            IN1=IN2+1
            IN2=IN2+24
            IF(NMAX.LT.IN2) IN2=NMAX
            WRITE(6,117) (N,N=IN1,IN2)
  117       FORMAT(2X,4HM(N=,I2,2H),24I5/)
            DO 120 M=1,MMAX
               WRITE(6,119) M,(DEPTH(N,M),N=IN1,IN2)
  119          FORMAT(1X,I2,1X,24F5.0)
  120       CONTINUE
            IF(IP.LT.NCP) WRITE(6,122)
  122       FORMAT(1H1//)
  130    CONTINUE
         WRITE(6,135)
  135    FORMAT(1H1,10X,22HCODED ARRAY FOLLOWS.../)
         NCP=NMAX/60
         IF(NCP.LT.1) NCP=1
         IN2=0
         DO 150 IP=1,NCP
            IN1=IN2+1
            IN2=IN2+60
            IF(NMAX.LT.IN2) IN2=NMAX
            WRITE(6,137) IN1,IN2
  137       FORMAT(10X,14HRANGE OF N IS,I3,4H TO,I3/)
            DO 140 M=1,MMAX
               WRITE(6,139) (ICODE(N,M),N=IN1,IN2)
  139          FORMAT(1X,60I2)
  140       CONTINUE
            IF(IP.LT.NCP) WRITE(6,122)
  150    CONTINUE
         WRITE(6,155) IWPT
  155    FORMAT(////10X,39HNUMBER OF GRID POINTS WITHIN ESTUARY =,I5/1H1)
         RETURN
      END
      SUBROUTINE AMBC(DEPTH,NMAX)
         COMMON/DIMEN/ NS,NSP1,NVL,NSC
         DIMENSION DEPTH(NMAX,1)
         COMMON/AMB/ NROA,IY,Y(10),ROA(10),H
         COMMON/BAY/ DX,DTL,XBARGE,ZBARGE,DXH,DXR,AREA
         COMMON/VSPECS/ IFORM,DU1,DU2,UU1,UU2,DW1,DW2,WW1,WW2,DL1,DL2
C     READ X AND Z COORDINATES (W/R TO LONG TERM GRID, IN FEET) OF
C     BARGE POSITION
         READ(5,5) XBARGE,ZBARGE
    5    FORMAT(8E10.0)
C     ....READ NUMBER OF POINTS WHERE AMBIENT DENSITY SPECIFIED....
         READ(5,15) NROA
   15    FORMAT(16I5)
C     ....READ VERTICAL DISTANCES FROM FREE SURFACE WHERE DENSITY SPECIFIED....
         READ(5,5) (Y(I),I=1,NROA)
C     ....READ AMBIENT DENSITIES....
         READ(5,5) (ROA(I),I=1,NROA)
         WRITE(6,25) XBARGE,ZBARGE
   25    FORMAT(1H1,10X,20HBARGE COORDINATES.../10X,14HXBARGE (FT) =,G12.4
     1   ,3X,14HZBARGE (FT) =,G12.4)
C     ....WRITE AMBIENT DENSITY PROFILE....
         WRITE(6,35)
   35    FORMAT(////29X,24H---AMBIENT CONDITIONS---)
         DO 60 J=1,NROA,8
            JJ=J+7
            IF(JJ.GE.NROA) JJ=NROA
            WRITE(6,45) (Y(I),I=J,JJ)
   45       FORMAT(//15X,10HDEPTH (FT),5X,8G12.4)
            WRITE(6,55) (ROA(I),I=J,JJ)
   55       FORMAT(9X,7HAMBIENT/9X,15HDENSITY (GM/CC),5X,8G12.4)
   60    CONTINUE
C     ....CONVERT AMBIENT DENSITY FROM UNITS OF GM/CC TO SLUGS/CUFT...
         DO 70 I=1,NROA
   70    ROA(I) = ROA(I)*1.94
C     SETH EQUAL TO DEPTH INTERPOLATED FROM FOUR GRID POINTS SURROUNDING BARGE
         CALL DINT(XBARGE,ZBARGE,H,DEPTH,NMAX)
         WRITE(6,75) H
   75    FORMAT(///10X,44HINTERPOLATED DEPTH AT DUMP COORDINATES, H =,
     1    G12.4,4H FT.)
         WRITE(6,95)
   95    FORMAT(/10X,10(8H--------))
         READ(5,165) IFORM
  165    FORMAT(16I5)
         IF(IFORM.GE.4) READ(5,5) DU1,DU2,UU1,UU2,DW1,DW2,WW1,WW2
         GOTO (430,440,450,460),IFORM
  430    WRITE(6,435)
  435    FORMAT(///10X,68HSINGLE VELOCITY PLANE USED WITH VELOCITIES
     1    CONSTANT IN THE VERTICAL )
         GOTO 480
  440    WRITE(6,445)
  445    FORMAT(///10X,53HSINGLE VELOCITY PLANE USED WITH LOGARITHMIC
     1    VELOCITY /10X,65HDISTRIBUTION SUCH THAT VERTICAL AVERAGE
     2    EQUALS SPECIFIED VELOCITY )
         GOTO 480
  450    WRITE(6,455)
  455    FORMAT(///10X,96HTWO VELOCITY PLANES USED WITH STRAIGHT LINE
     1    INTERPOLATION (SEE FIGURE 6.2(C) FOR INTERPRETATION))
         GOTO 480
  460    WRITE(6,465) DU1,DU2,UU1,UU2,DW1,DW2,WW1,WW2
  465    FORMAT(///10X,73HTWO VELOCITY PROFILES SPECIFIED IN X AND Z
     1    DIRECTIONS FOR--QUICK LOOKS--/10X,63HDEPTH ASSUMED CONSTANT
     2    AND VELOCITIES CONSIDERED STEADY IN TIME/10X,
     3    37HVELOCITY PROFILE PARAMETERS FOLLOW.../10X,
     4    6HDU1 =,G11.3,1X,6HDU2 =,G11.3,1X,6HUU1 =,G11.3,
     5    1X,6HUU2 =,G11.3/10X,6HDW1 =,G11.3,1X,6HDW2 =,G11.3,1X,
     6    6HWW1 =,G11.3,1X,6HWW2 =,G11.3)
  480    CONTINUE
         RETURN
      END